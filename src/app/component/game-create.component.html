<div class="sceneContainer" #sceneContainer></div>
<div class="overlay d-flex flex-column pointer-none">
    <div class="flex-grow-1 d-flex">
        <div class="treeContainer wideTree pointer-auto">
            <ul class="nav nav-tabs nav-fill" role="tablist">
                <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#game-create-elements" role="tab" (click)="sequenceCurrentItem = null; selectMethod(null)">Elemente</a></li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#game-create-sequence" role="tab" (click)="selectElement(null); selectMethod(null)">Ablauf</a></li>
                <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#game-create-methods" role="tab" (click)="selectElement(null); sequenceCurrentItem = null">Methoden</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane full-height active" id="game-create-elements" role="tabpanel">
                    <div class="full-height d-flex flex-column">
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown">Element hinzufügen</button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                <ng-container *ngFor="let type of elementTypes">
                                    <div class="row">
                                        <div class="col">
                                            <a class="dropdown-item" href="#" (click)="addElement(type.key)">{{type.label}}</a>
                                        </div>
                                        <div class="col col-auto" *ngIf="type.bulk">
                                            <a class="dropdown-item" href="#" (click)="startBulkCreate(type.key)">+mehrere</a>
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                        <div class="treeList flex-grow-1">
                            <div class="list-group">
                              <a href="#" *ngFor="let element of elements; let i = index" class="list-group-item" [ngClass]="{'active': currentElementIndex == i}" (click)="selectElement(i)">{{element.id}}</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane full-height" id="game-create-sequence" role="tabpanel">
                    <div class="full-height d-flex flex-column">
                        <button class="btn btn-secondary" (click)="createSequence()">Neue Sequenz anlegen</button>
                        <div class="treeList flex-grow-1">
                            <div class="list-group">
                                <recursiveTree [nodes]="sequences" (selectItem)="selectSequenceItem($event)" [currentNode]="sequenceCurrentItem" [possibleCommands]="possibleCommands" (addCommand)="addCommand($event.id, $event.section, $event.command)" (deleteItem)="deleteItem($event)" (moveUp)="moveItemUp($event)" (moveDown)="moveItemDown($event)"></recursiveTree>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane full-height" id="game-create-methods" role="tabpanel">
                    <div class="full-height d-flex flex-column">
                        <button class="btn btn-secondary" (click)="createMethod()">Neue Methode anlegen</button>
                        <div class="treeList flex-grow-1">
                            <div class="list-group">
                                <a href="#" *ngFor="let method of methods; let i = index" class="list-group-item" [ngClass]="{'active': currentMethodIndex == i}" (click)="selectMethod(i)">{{method.name}}</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex-grow-1" *ngIf="currentMethodIndex === null"></div>
        <div class="treeContainer fullWidthTree pointer-auto" *ngIf="currentMethodIndex !== null">
            <ul class="nav nav-tabs nav-fill" role="tablist">
                <li class="nav-item"><a class="nav-link active"  data-toggle="tab" href="#">Codeeditor</a></li>
            </ul>
            <div class="tab-content">
                <div class="aceEditor" ace-editor [(text)]="methods[currentMethodIndex].code"
                     [mode]="'javascript'"
                     [theme]="'eclipse'"
                     [options]="methodOptions"
                     [readOnly]="false"
                     [autoUpdateContent]="true"
                ></div>
            </div>
        </div>

        <div class="treeContainer wideTree pointer-auto" *ngIf="currentElementIndex !== null">
            <ul class="nav nav-tabs nav-fill" role="tablist">
                <li class="nav-item"><a class="nav-link active"  data-toggle="tab" href="#game-create-attributes">{{elements[currentElementIndex].id}}</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane full-height active d-flex flex-column" id="game-create-attributes" role="tabpanel">
                    <div class="treeList flex-grow-1">
                        <ul class="list-group">
                            <ng-container *ngFor="let option of getElementDefinition(elements[currentElementIndex].type).options">
                                <li class="list-group-item" *ngIf="option.type !== 'hidden'">
                                    <label class="attribute-label" [for]="'game-create-attributes-' + option.key">{{option.label}}</label>
                                    <div class="attribute-input">
                                        <ng-container *ngIf="option.type === 'length'">
                                            <input [id]="'game-create-attributes-' + option.key" class="form-control hasOverlay" type="number" step="0.1" min="0.1" max="200" [value]="elements[currentElementIndex].element[option.key]" (input)="updateAttribute(option.key, $event.target.value)">
                                            <span class="inputOverlay">cm</span>
                                        </ng-container>
                                        <ng-container *ngIf="option.type === 'select'">
                                            <select [id]="'game-create-attributes-' + option.key" class="form-control" (change)="updateAttribute(option.key, $event.target.value)">
                                                <option [value]="value.key" *ngFor="let value of option.values" [selected]="elements[currentElementIndex].element[option.key] == value.key ? 'selected' : ''">{{value.label}}</option>
                                            </select>
                                        </ng-container>
                                        <ng-container *ngIf="option.type === 'rotation'">
                                            <input [id]="'game-create-attributes-' + option.key" class="form-control hasOverlay" type="number" step="1" min="0" max="360" [value]="elements[currentElementIndex].element[option.key]" (input)="updateAttribute(option.key, $event.target.value)">
                                            <span class="inputOverlay">°</span>
                                        </ng-container>
                                        <ng-container *ngIf="option.type === 'image'">
                                            <input [id]="'game-create-attributes-' + option.key" class="form-control" type="file" value="" (change)="updateAttribute(option.key, $event.target.value)">
                                        </ng-container>
                                        <ng-container *ngIf="option.type === 'color'">
                                            <input [id]="'game-create-attributes-' + option.key" class="form-control" type="text" [value]="elements[currentElementIndex].element[option.key]" (input)="updateAttribute(option.key, $event.target.value)">
                                        </ng-container>
                                        <ng-container *ngIf="option.type === 'model'">
                                            <input [id]="'game-create-attributes-' + option.key" class="form-control" type="file" value="" (change)="updateAttribute(option.key, $event.target.value)">
                                        </ng-container>
                                        <ng-container *ngIf="option.type === 'text'">
                                            <input [id]="'game-create-attributes-' + option.key" class="form-control" type="text" [value]="elements[currentElementIndex].element[option.key]" (input)="updateAttribute(option.key, $event.target.value)">
                                        </ng-container>
                                        <ng-container *ngIf="option.type === 'pieceContainer_v1_positions'">
                                            <button class="btn btn-secondary btn-block" (click)="startPositionEditor()">Zum Positionseditor</button>
                                        </ng-container>
                                    </div>
                                </li>
                            </ng-container>
                            <li class="list-group-item">
                                <label class="attribute-label" [for]="'game-create-options-tags'">Tags</label>
                                <div class="attribute-input">
                                    <tag-input [id]="'game-create-options-tags'" [(ngModel)]="elements[currentElementIndex].tags"></tag-input>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="treeContainer wideTree pointer-auto" *ngIf="sequenceCurrentItem !== null">
            <ul class="nav nav-tabs nav-fill" role="tablist">
                <li class="nav-item"><a class="nav-link active"  data-toggle="tab" href="#game-create-sequencesettings">Eigenschaften von {{getSequenceById(sequenceCurrentItem).command}}</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane full-height active d-flex flex-column" id="game-create-sequencesettings" role="tabpanel">
                    <div class="treeList flex-grow-1">
                        <ul class="list-group">
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'if'">

                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'for'">

                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'foreach'">

                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'while'">

                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'points'">

                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'wait'">

                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'move'">
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-mode'">Selektier-Modus</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-mode'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.mode = $event.target.value">
                                            <option value="element" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'element' ? 'selected' : ''">Bestimmtes Element</option>
                                            <option value="tag" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'tags' ? 'selected' : ''">Passend auf Tag</option>
                                            <option value="loop" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'loop' ? 'selected' : ''">Aktuelles Schleifenelement</option>
                                            <option value="method" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'method' ? 'selected' : ''">Methodenaufruf</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'element'">
                                    <label class="attribute-label" [for]="'game-create-command-element'">Element</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-element'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.element = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="element.id" *ngFor="let element of elements" [selected]="getSequenceById(sequenceCurrentItem).options.element == element.id ? 'selected' : ''">{{element.id}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'tag'">
                                    <label class="attribute-label" [for]="'game-create-command-tag'">Alle Element mit Tag</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-tag'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.tag = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="tag.value" *ngFor="let tag of getDistinctTags()" [selected]="getSequenceById(sequenceCurrentItem).options.tag == tag.value ? 'selected' : ''">{{tag.display}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'loop'">
                                    <label class="attribute-label" [for]="'game-create-command-loop'">Element aus ForEach</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-loop'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.loop = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="loop.id" *ngFor="let loop of getOuterForEachLoops(sequenceCurrentItem)" [selected]="getSequenceById(sequenceCurrentItem).options.loop == loop.id ? 'selected' : ''">{{getCommandDefinition(loop.command).displayText(loop)}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'method'">
                                    <label class="attribute-label" [for]="'game-create-command-method'">Element(e) aus Methode</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-method'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.method = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="method.id" *ngFor="let method of methods" [selected]="getSequenceById(sequenceCurrentItem).options.method == method.id ? 'selected' : ''">{{method.name}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'method'">
                                    Die Methode muss ein Array von Elementen zurückgeben. Alternativ können auch nur die IDs der Elemente zurückgegeben werden. Es ist auch möglich, lediglich ein Elemente bzw. eine ID zurückzugeben.
                                </li>

                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-targetmode'">Ziel-Modus</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-targetmode'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.targetmode = $event.target.value">
                                            <option value="element" [selected]="getSequenceById(sequenceCurrentItem).options.targetmode == 'element' ? 'selected' : ''">Bestimmtes Element</option>
                                            <option value="loop" [selected]="getSequenceById(sequenceCurrentItem).options.targetmode == 'loop' ? 'selected' : ''">Aktuelles Schleifenelement</option>
                                            <option value="method" [selected]="getSequenceById(sequenceCurrentItem).options.targetmode == 'method' ? 'selected' : ''">Methodenaufruf</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.targetmode == 'element'">
                                    <label class="attribute-label" [for]="'game-create-command-targetelement'">Ziel-Element</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-targetelement'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.targetelement = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="element.id" *ngFor="let element of elements" [selected]="getSequenceById(sequenceCurrentItem).options.targetelement == element.id ? 'selected' : ''">{{element.id}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.targetmode == 'loop'">
                                    <label class="attribute-label" [for]="'game-create-command-targetloop'">Ziel-Element aus ForEach</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-targetloop'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.targetloop = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="loop.id" *ngFor="let loop of getOuterForEachLoops(sequenceCurrentItem)" [selected]="getSequenceById(sequenceCurrentItem).options.targetloop == loop.id ? 'selected' : ''">{{getCommandDefinition(loop.command).displayText(loop)}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.targetmode == 'method'">
                                    <label class="attribute-label" [for]="'game-create-command-method'">Ziel-Element aus Methode</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-method'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.targetmode = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="method.id" *ngFor="let method of methods" [selected]="getSequenceById(sequenceCurrentItem).options.targetmode == method.id ? 'selected' : ''">{{method.name}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.targetmode == 'method'">
                                    Die Methode muss ein Element oder die ID eines Elementes zurückgeben.
                                </li>
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-targettype'">Ziel-Elementtyp</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-targettype'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.targettype = $event.target.value; getSequenceById(sequenceCurrentItem).options.targetdata = getDefaultTargetOptions($event.target.value)">
                                            <option value="">-- Bitte wählen --</option>
                                            <ng-container *ngFor="let elementType of elementTypes">
                                                <option *ngIf="elementType.targetOptions !== null" [value]="elementType.key" [selected]="getSequenceById(sequenceCurrentItem).options.targettype == elementType.key ? 'selected' : ''">{{elementType.label}}</option>
                                            </ng-container>
                                        </select>
                                    </div>
                                </li>
                                <ng-container *ngIf="getSequenceById(sequenceCurrentItem).options.targettype">
                                    <ng-container *ngFor="let option of getElementDefinition(getSequenceById(sequenceCurrentItem).options.targettype).targetOptions">
                                        <ng-container *ngIf="!isFunction(option.onlyIf) || option.onlyIf(getSequenceById(sequenceCurrentItem).options.targetdata)">
                                            <li class="list-group-item" *ngIf="option.type == 'number'">
                                                <label class="attribute-label" [for]="'game-create-command-targetoption-' + option.key">{{option.label}}</label>
                                                <div class="attribute-input">
                                                    <input [id]="'game-create-command-targetoption-' + option.key" class="form-control" type="number" step="1" [value]="getSequenceById(sequenceCurrentItem).options.targetdata[option.key]" (input)="getSequenceById(sequenceCurrentItem).options.targetdata[option.key] = $event.target.value">
                                                </div>
                                            </li>
                                            <li class="list-group-item" *ngIf="option.type == 'select'">
                                                <label class="attribute-label" [for]="'game-create-command-targetoption-' + option.key">{{option.label}}</label>
                                                <div class="attribute-input">
                                                    <select [id]="'game-create-command-targetoption-' + option.key" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.targetdata[option.key] = $event.target.value">
                                                        <ng-container *ngFor="let value of option.values">
                                                            <option  [value]="value.key" [selected]="getSequenceById(sequenceCurrentItem).options.targetdata[option.key] == value.key ? 'selected' : ''">{{value.label}}</option>
                                                        </ng-container>
                                                    </select>
                                                </div>
                                            </li>
                                        </ng-container>
                                    </ng-container>
                                </ng-container>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'change'">
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-mode'">Modus</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-mode'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.mode = $event.target.value">
                                            <option value="element" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'element' ? 'selected' : ''">Bestimmtes Element</option>
                                            <option value="tag" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'tags' ? 'selected' : ''">Passend auf Tag</option>
                                            <option value="loop" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'loop' ? 'selected' : ''">Aktuelles Schleifenelement</option>
                                            <option value="method" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'method' ? 'selected' : ''">Methodenaufruf</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'element'">
                                    <label class="attribute-label" [for]="'game-create-command-element'">Element</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-element'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.element = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="element.id" *ngFor="let element of elements" [selected]="getSequenceById(sequenceCurrentItem).options.element == element.id ? 'selected' : ''">{{element.id}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'tag'">
                                    <label class="attribute-label" [for]="'game-create-command-tag'">Alle Element mit Tag</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-tag'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.tag = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="tag.value" *ngFor="let tag of getDistinctTags()" [selected]="getSequenceById(sequenceCurrentItem).options.tag == tag.value ? 'selected' : ''">{{tag.display}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'loop'">
                                    <label class="attribute-label" [for]="'game-create-command-loop'">Element aus ForEach</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-loop'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.loop = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="loop.id" *ngFor="let loop of getOuterForEachLoops(sequenceCurrentItem)" [selected]="getSequenceById(sequenceCurrentItem).options.loop == loop.id ? 'selected' : ''">{{getCommandDefinition(loop.command).displayText(loop)}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'method'">
                                    <label class="attribute-label" [for]="'game-create-command-method'">Methode</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-method'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.method = $event.target.value">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="method.id" *ngFor="let method of methods" [selected]="getSequenceById(sequenceCurrentItem).options.method == method.id ? 'selected' : ''">{{method.name}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.mode == 'method'">
                                    Die Methode muss ein Array von Elementen zurückgeben. Alternativ können auch nur die IDs der Elemente zurückgegeben werden. Es ist auch möglich, lediglich ein Elemente bzw. eine ID zurückzugeben.
                                </li>
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-option'">Eigenschaft</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-option'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.option = $event.target.value; getSequenceById(sequenceCurrentItem).options.value = ($event.target.value ? getElementAction($event.target.value).defaultValue : null)">
                                            <option value="">-- Bitte wählen --</option>
                                            <option [value]="action.key" *ngFor="let action of getPossibleElementActions()" [selected]="getSequenceById(sequenceCurrentItem).options.option == action.key ? 'selected' : ''">{{action.label}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.option && getElementAction(getSequenceById(sequenceCurrentItem).options.option).type == 'select'">
                                    <label class="attribute-label" [for]="'game-create-command-value'">Wert</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-value'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.value = $event.target.value">
                                            <option [value]="value.key" *ngFor="let value of getElementAction(getSequenceById(sequenceCurrentItem).options.option).values" [selected]="getSequenceById(sequenceCurrentItem).options.value == value.key ? 'selected' : ''">{{value.label}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.option && getElementAction(getSequenceById(sequenceCurrentItem).options.option).type == 'rotation'">
                                    <label class="attribute-label" [for]="'game-create-command-value'">Wert</label>
                                    <div class="attribute-input">
                                        <input [id]="'game-create-command-value'" class="form-control hasOverlay" type="number" step="1" min="0" max="360" [value]="getSequenceById(sequenceCurrentItem).options.value" (input)="getSequenceById(sequenceCurrentItem).options.value = $event.target.value">
                                        <span class="inputOverlay">°</span>
                                    </div>
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'notification'">
                                <li class="list-group-item bigInput">
                                    <label class="attribute-label" [for]="'game-create-command-text'">Text</label>
                                    <div class="attribute-input">
                                        <input [id]="'game-create-command-text'" class="form-control" type="text" [value]="getSequenceById(sequenceCurrentItem).options.text" (input)="getSequenceById(sequenceCurrentItem).options.text = $event.target.value">
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    Verwende den Platzhalter %currentPlayer%, damit dieser durch den Spieler ersetzt wird, der die letzte Aktion ausgeführt hat.
                                </li>
                                <li class="list-group-item" *ngFor="let loop of getOuterForEachLoops(sequenceCurrentItem)">
                                    Verwende den Platzhalter %loop{{loop.id}}%, damit dieser durch den Spieler ersetzt wird, der in der {{getCommandDefinition(loop.command).displayText(loop)}}-Schleife gerade dran ist.
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'status'">
                                <li class="list-group-item bigInput">
                                    <label class="attribute-label" [for]="'game-create-command-text'">Text</label>
                                    <div class="attribute-input">
                                        <input [id]="'game-create-command-text'" class="form-control" type="text" [value]="getSequenceById(sequenceCurrentItem).options.text" (input)="getSequenceById(sequenceCurrentItem).options.text = $event.target.value">
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    Verwende den Platzhalter %currentPlayer%, damit dieser durch den oder die (kommaseparierten) Spieler ersetzt wird, die gerade eine Aktion ausführen können.
                                </li>
                                <li class="list-group-item" *ngFor="let loop of getOuterForEachLoops(sequenceCurrentItem)">
                                    Verwende den Platzhalter %loop{{loop.id}}%, damit dieser durch den Spieler ersetzt wird, der in der {{getCommandDefinition(loop.command).displayText(loop)}}-Schleife gerade dran ist.
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'progress'">
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-mode'">Modus</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-mode'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.mode = $event.target.value">
                                            <option value="add" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'add' ? 'selected' : ''">Um Wert erhöhen</option>
                                            <option value="set" [selected]="getSequenceById(sequenceCurrentItem).options.mode == 'set' ? 'selected' : ''">Auf Wert setzen</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-method'">Berechnende Methode</label>
                                    <div class="attribute-input">
                                        <select [id]="'game-create-command-method'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.method = $event.target.value; getSequenceById(sequenceCurrentItem).percent = $event.target.value ? null : 0">
                                            <option value="">-- Fester Wert --</option>
                                            <option [value]="method.id" *ngFor="let method of methods" [selected]="getSequenceById(sequenceCurrentItem).options.method == method.id ? 'selected' : ''">{{method.name}}</option>
                                        </select>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="!getSequenceById(sequenceCurrentItem).options.method">
                                    <label class="attribute-label" [for]="'game-create-command-percent'">Fester Wert</label>
                                    <div class="attribute-input">
                                        <input [id]="'game-create-command-percent'" class="form-control hasOverlay" type="number" min="0" step="1" max="100" [value]="getSequenceById(sequenceCurrentItem).options.percent" (input)="getSequenceById(sequenceCurrentItem).options.percent = $event.target.value">
                                        <span class="inputOverlay">%</span>
                                    </div>
                                </li>
                                <li class="list-group-item" *ngIf="getSequenceById(sequenceCurrentItem).options.method">
                                    Die Methode muss einen Wert zwischen 0 (= 0%) und 1 (= 100%) returnen.
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'finish'">

                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'sequence'">
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-sequence'">Aufzurufende Sequenz</label>
                                    <div class="attribute-input" *ngIf="getCustomSequences().length">
                                        <select [id]="'game-create-command-sequence'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.sequence = $event.target.value">
                                            <option value="">-- Bitte auswählen --</option>
                                            <option [value]="sequence.id" *ngFor="let sequence of getCustomSequences()" [selected]="getSequenceById(sequenceCurrentItem).options.sequence == sequence.id ? 'selected' : ''">{{sequence.name}}</option>
                                        </select>
                                    </div>
                                    <div class="attribute-input" *ngIf="!getCustomSequences().length">
                                        Bitte zuerst eine eigene Sequenz erstellen.
                                    </div>
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'method'">
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-method'">Aufzurufende Methode</label>
                                    <div class="attribute-input" *ngIf="methods.length">
                                        <select [id]="'game-create-command-method'" class="form-control" (change)="getSequenceById(sequenceCurrentItem).options.method = $event.target.value">
                                            <option value="">-- Bitte auswählen --</option>
                                            <option [value]="method.id" *ngFor="let method of methods" [selected]="getSequenceById(sequenceCurrentItem).options.method == method.id ? 'selected' : ''">{{method.name}}</option>
                                        </select>
                                    </div>
                                    <div class="attribute-input" *ngIf="!methods.length">
                                        Bitte zuerst eine Methode erstellen.
                                    </div>
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'sleep'">
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-time'">Dauer</label>
                                    <div class="attribute-input">
                                        <input [id]="'game-create-command-time'" class="form-control hasOverlay" type="number" min="0" step="1000" [value]="getSequenceById(sequenceCurrentItem).options.time" (input)="getSequenceById(sequenceCurrentItem).options.time = $event.target.value">
                                        <span class="inputOverlay">ms</span>
                                    </div>
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command == 'break'">
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-hirarchy'">Ebenen verlassen</label>
                                    <div class="attribute-input">
                                        <input [id]="'game-create-command-hirarchy'" class="form-control" type="number" min="1" step="1" [value]="getSequenceById(sequenceCurrentItem).options.hirarchy" (input)="getSequenceById(sequenceCurrentItem).options.hirarchy = $event.target.value">
                                    </div>
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command === null && getSequenceById(sequenceCurrentItem).deletable">
                                <li class="list-group-item">
                                    <label class="attribute-label" [for]="'game-create-command-label'">Bezeichnung</label>
                                    <div class="attribute-input">
                                        <input [id]="'game-create-command-label'" class="form-control" type="text" [value]="getSequenceById(sequenceCurrentItem).name" (input)="getSequenceById(sequenceCurrentItem).name = $event.target.value">
                                    </div>
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command === null && !getSequenceById(sequenceCurrentItem).deletable && getSequenceById(sequenceCurrentItem).name == 'onGameSetup'">
                                <li class="list-group-item">
                                    Diese Sequenz wird direkt beim Erstellen des Spiels ausgeführt. Hier sollten schonmal alle Elemente, die auf jedenfall für das Spiel benötigt werden, auf den Tisch gelegt werden.
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command === null && !getSequenceById(sequenceCurrentItem).deletable && getSequenceById(sequenceCurrentItem).name == 'onPlayerJoin'">
                                <li class="list-group-item">
                                    Diese Sequenz wird aufgerufen, sobald ein Spieler an dem Tisch Platz nimmt. Hier können die Spielerspezifischen Elemente auf den Tisch gelegt werden (wie z.B. seine eigenen Spielfiguren, die natürlich nur gebraucht werden, wenn sein Slot gefüllt ist). Die Sequenz wird auch aufgerufen, wenn ein Spieler seinen Platz wechselt (nachdem bei seinem alten Platz die onPlayerLeave Sequenz aufgerufen wurde).
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command === null && !getSequenceById(sequenceCurrentItem).deletable && getSequenceById(sequenceCurrentItem).name == 'onPlayerLeave'">
                                <li class="list-group-item">
                                    Diese Sequenz wird aufgerufen, sobald ein Spieler seinen Platz verlässt. Hier müssen wieder seine eigenen Spielfiguren/etc. vom Tisch genommen werden. Die Sequenz wird auch aufgerufen, wenn er seinen Platz nur wechselt.
                                </li>
                            </ng-container>
                            <ng-container *ngIf="getSequenceById(sequenceCurrentItem).command === null && !getSequenceById(sequenceCurrentItem).deletable && getSequenceById(sequenceCurrentItem).name == 'onGameStart'">
                                <li class="list-group-item">
                                    Diese Sequenz wird aufgerufen, sobald der Spielleiter die Partie startet. Hier sollte also die gesamte Spiellogik reinkommen. Läuft diese Sequenz zu Ende, endet das Spiel automatisch.
                                </li>
                            </ng-container>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="treeContainer wideTree pointer-auto" *ngIf="currentMethodIndex !== null">
            <ul class="nav nav-tabs nav-fill" role="tablist">
                <li class="nav-item"><a class="nav-link active"  data-toggle="tab" href="#game-create-methodsettings">Eigenschaften</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane full-height active d-flex flex-column" id="game-create-methodsettings" role="tabpanel">
                    <div class="treeList flex-grow-1">
                        <ul class="list-group">
                            <li class="list-group-item">
                                <label class="attribute-label" [for]="'game-create-method-name'">Name</label>
                                <div class="attribute-input">
                                    <input [id]="'game-create-method-name'" class="form-control" type="text" [value]="methods[currentMethodIndex].name" (input)="methods[currentMethodIndex].name = $event.target.value">
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal" id="bulkCreateModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <form (submit)="bulkCreate()" *ngIf="bulkCreateKey">
                <div class="modal-header">
                    <h5 class="modal-title">Mehrere {{getElementDefinition(bulkCreateKey).labelPlural}} erstellen</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h5>1. Anzahl festlegen</h5>

                    <ng-container *ngIf="getElementDefinition(bulkCreateKey).bulk.type == 'count'">
                        <div class="form-group row">
                            <label for="game-create-bulkcreate-count" class="col-6 col-form-label">Anzahl:</label>
                            <div class="col-6">
                                <input type="number" min="1" class="form-control" id="game-create-bulkcreate-count" value="1" (input)="bulkCreateCount = $event.target.value">
                            </div>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="getElementDefinition(bulkCreateKey).bulk.type == 'file'">
                        <div class="form-group row">
                            <label [for]="'game-create-bulkcreate-' + getElementDefinition(bulkCreateKey).bulk.key" class="col-6 col-form-label">{{getOptionDefinition(bulkCreateKey, getElementDefinition(bulkCreateKey).bulk.key).label}}:</label>
                            <div class="col-6">
                                <input [id]="'game-create-bulkcreate-' + getElementDefinition(bulkCreateKey).bulk.key" class="form-control" type="file" multiple value="" (change)="setBulkCountByFileInput()">
                            </div>
                        </div>
                    </ng-container>

                    <h5>2. Gleiche Eigenschaften für alle festlegen</h5>

                    <ng-container *ngFor="let option of getElementDefinition(bulkCreateKey).options">
                        <div class="form-group row" *ngIf="option.type !== 'hidden' && option.key !== getElementDefinition(bulkCreateKey).bulk.key">
                            <label [for]="'game-create-bulkcreate-' + option.key" class="col-6 col-form-label">{{option.label}}</label>
                            <div class="col-6">
                                <div class="modalAttributeInput">
                                    <ng-container *ngIf="option.type === 'length'">
                                        <input [id]="'game-create-bulkcreate-' + option.key" class="form-control hasOverlay" type="number" step="0.1" min="0.1" max="200" [value]="option.defaultValue">
                                        <span class="inputOverlay">cm</span>
                                    </ng-container>
                                    <ng-container *ngIf="option.type === 'select'">
                                        <select [id]="'game-create-bulkcreate-' + option.key" class="form-control">
                                            <option [value]="value.key" *ngFor="let value of option.values" [selected]="option.defaultValue == value.key ? 'selected' : ''">{{value.label}}</option>
                                        </select>
                                    </ng-container>
                                    <ng-container *ngIf="option.type === 'rotation'">
                                        <input [id]="'game-create-bulkcreate-' + option.key" class="form-control hasOverlay" type="number" step="1" min="0" max="360" [value]="option.defaultValue">
                                        <span class="inputOverlay">°</span>
                                    </ng-container>
                                    <ng-container *ngIf="option.type === 'image'">
                                        <input [id]="'game-create-bulkcreate-' + option.key" class="form-control" type="file" value="">
                                    </ng-container>
                                    <ng-container *ngIf="option.type === 'color'">
                                        <input [id]="'game-create-bulkcreate-' + option.key" class="form-control" type="text" [value]="option.defaultValue">
                                    </ng-container>
                                    <ng-container *ngIf="option.type === 'model'">
                                        <input [id]="'game-create-bulkcreate-' + option.key" class="form-control" type="file" value="">
                                    </ng-container>
                                    <ng-container *ngIf="option.type === 'text'">
                                        <input [id]="'game-create-bulkcreate-' + option.key" class="form-control" type="text" [value]="option.defaultValue">
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                    <div class="form-group row">
                        <label [for]="'game-create-bulkcreate-tags'" class="col-6 col-form-label">Tags</label>
                        <div class="col-6">
                            <div class="modalAttributeInput">
                                <tag-input [id]="'game-create-bulkcreate-tags'" [(ngModel)]="bulkCreateTags" [ngModelOptions]="{standalone: true}"></tag-input>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" [disabled]="bulkCreateCount == 0">{{bulkCreateCount}} erstellen</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="positionEditorContainer d-flex flex-column" *ngIf="positionEditorActive">
    <div class="row justify-content-center flex-shrink-0">
        <div class="col col-auto alert alert-white mg-top-lg">
            <div class="row">
                <div class="col col-auto">
                    Vorlagenelement auswählen, auf dem später dieser PieceContainer liegen wird:
                </div>
                <div class="col col-auto">
                    <select class="form-control" (input)="positionEditorTemplateElementId = $event.target.value">
                        <option value="">Tisch/Beliebig</option>
                        <ng-container *ngFor="let element of elements; let i = index">
                            <option *ngIf="i != currentElementIndex && ['tile_v1', 'card_v1', 'board_v1'].indexOf(element.type) > -1" [value]="element.id">{{element.id}}</option>
                        </ng-container>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <button class="btn btn-primary" (click)="savePositionEditor()">Speichern</button>
                    <button class="btn btn-secondary" (click)="cancelPositionEditor()">Abbrechen</button>

                    <div class="btn-group btn-group-sm pull-right mg-top-sm" data-toggle="buttons">
                        <label class="btn btn-secondary active" (click)="positionEditorTool = 'createPoint'">
                            <input type="radio" autocomplete="off" checked> + Punkt
                        </label>
                        <label class="btn btn-secondary" (click)="positionEditorTool = 'deletePoint'">
                            <input type="radio" autocomplete="off"> - Punkt
                        </label>
                        <label class="btn btn-secondary" (click)="positionEditorTool = 'createJoint'; positionStartJointIndex = null">
                            <input type="radio" autocomplete="off"> + Verbindung
                        </label>
                        <label class="btn btn-secondary" (click)="positionEditorTool = 'deleteJoint'">
                            <input type="radio" autocomplete="off"> - Verbindung
                        </label>
                    </div>
                </div>
            </div>
            <div class="row" *ngIf="positionEditorTool == 'createJoint'">
                <div class="col">
                    <div class="btn-group btn-group-sm pull-right">
                        <button class="btn btn-secondary" (click)="selectAllSlotIndexes()">Alle</button>
                        <button class="btn btn-secondary" (click)="deselectAllSlotIndexes()">Keine</button>
                    </div>
                    <div class="btn-group btn-group-sm pull-right" data-toggle="buttons">
                        <label class="btn btn-secondary active" *ngFor="let slotIndex of templatePlayerSlotIndexes" [style]="'box-shadow: 0 0 5px ' + templatePlayerColors[slotIndex] + ' inset' | safeStyle">
                            <input type="checkbox" [id]="'templatePlayerSlotIndex' + slotIndex" autocomplete="off" checked> {{slotIndex}}
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="flex-grow-1 overflow-auto">
        <div [class]="'positionTemplateContainer ' + positionEditorTool" #templateContainer [style]="'width: ' + (getWidthOfTemplate() + templatePadding * 2) + 'px; height: ' + (getHeightOfTemplate() + templatePadding * 2) + 'px; padding-left: ' + (getWidthOfTemplate() / 2 + templatePadding) + 'px; padding-top: ' + (getHeightOfTemplate() / 2 + templatePadding) + 'px;' | safeStyle">
            <div class="positionTemplateBackground pointer-none" [style]="'width: ' + getWidthOfTemplate() + 'px; height: ' + getHeightOfTemplate() + 'px; left: ' + templatePadding + 'px; top: ' + templatePadding + 'px; background-image: url(' + getImageOfTemplate() + '); background-size: ' + getWidthOfTemplate() + 'px ' + getHeightOfTemplate() + 'px;' | safeStyle"></div>
            <svg class="arrowContainer" [attr.width]="getWidthOfTemplate() + templatePadding * 2" [attr.height]="getHeightOfTemplate() + templatePadding * 2">
                <defs>
                  <marker id='arrowOuter' orient="auto"
                    [attr.markerWidth]='20' [attr.markerHeight]='20'
                    [attr.refX]='elements[currentElementIndex].element.stackElementRadius * templateFactor / 4 + 7' [attr.refY]='4.5'>
                    <!-- triangle pointing right (+x) -->
                      <path d='M0,0 L0,9 L9,4.5 z' fill="black"></path>
                  </marker>
                  <marker id='arrowInner' orient="auto"
                    [attr.markerWidth]='10' [attr.markerHeight]='10'
                    [attr.refX]='elements[currentElementIndex].element.stackElementRadius * templateFactor / 4 + 6' [attr.refY]='3'>
                    <!-- triangle pointing right (+x) -->
                      <path d='M0,0 L0,6 L6,3 z' fill="white"></path>
                  </marker>
                </defs>
                <ng-container *ngFor="let arrow of positionArrows">
                    <line [attr.x1]="arrow.from.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y1]="arrow.from.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" [attr.x2]="arrow.to.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y2]="arrow.to.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" stroke="black" stroke-width="6"></line>
                    <line marker-end="url(#arrowOuter)" [attr.x1]="arrow.from.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y1]="arrow.from.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" [attr.x2]="arrow.to.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y2]="arrow.to.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" stroke-width="2"></line>
                </ng-container>
                <ng-container *ngFor="let arrow of positionArrows">
                    <ng-container *ngIf="arrow.allowedSlotIndexes.length == templatePlayerCount">
                        <line [attr.x1]="arrow.from.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y1]="arrow.from.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" [attr.x2]="arrow.to.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y2]="arrow.to.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" [attr.stroke]="'white'" stroke-width="2"></line>
                    </ng-container>
                    <ng-container *ngIf="arrow.allowedSlotIndexes.length < templatePlayerCount">
                        <ng-container *ngFor="let slotIndex of arrow.allowedSlotIndexes; let i = index">
                            <line [attr.x1]="arrow.from.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y1]="arrow.from.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" [attr.x2]="arrow.to.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y2]="arrow.to.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" [attr.stroke]="templatePlayerColors[slotIndex]" [attr.stroke-dasharray]="'0,' + (i * 10) + ',10,' + ((arrow.allowedSlotIndexes.length - 1 - i) * 10)" stroke-width="2"></line>
                        </ng-container>
                    </ng-container>
                    <line marker-end="url(#arrowInner)" [attr.x1]="arrow.from.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y1]="arrow.from.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" [attr.x2]="arrow.to.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y2]="arrow.to.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" stroke="transparent" stroke-width="2"></line>

                    <line [attr.x1]="arrow.from.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y1]="arrow.from.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" [attr.x2]="arrow.to.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding" [attr.y2]="arrow.to.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding" stroke="transparent" stroke-width="20" (click)="clickJoint(arrow)">
                        <title *ngIf="arrow.allowedSlotIndexes.length == templatePlayerCount">Für alle Spieler</title>
                        <title *ngIf="arrow.allowedSlotIndexes.length < templatePlayerCount">Nur für Spieler {{arrow.allowedSlotIndexes.join(', ')}}</title>
                    </line>
                </ng-container>
            </svg>
            <div class="point pointer-none" [ngClass]="{'pointer-none': positionEditorTool == 'createPoint', 'selected': positionEditorTool == 'createJoint' && i == positionStartJointIndex}" *ngFor="let position of positionEditorPositions; let i = index" (click)="clickPoint(i)" [style]="'left: ' + (position.x * templateFactor + getWidthOfTemplate() / 2 + templatePadding - elements[currentElementIndex].element.stackElementRadius / 2 * templateFactor) + 'px; top: ' + (position.y * templateFactor + getHeightOfTemplate() / 2 + templatePadding - elements[currentElementIndex].element.stackElementRadius / 2 * templateFactor) + 'px; width: ' + (elements[currentElementIndex].element.stackElementRadius * templateFactor) + 'px; height: ' + (elements[currentElementIndex].element.stackElementRadius * templateFactor) + 'px; border-radius: ' + (elements[currentElementIndex].element.stackElementRadius * templateFactor / 2) + 'px;' | safeStyle"></div>
            <div class="point preview pointer-none" *ngIf="positionEditorTool == 'createPoint'" [style]="'width: ' + (elements[currentElementIndex].element.stackElementRadius * templateFactor) + 'px; height: ' + (elements[currentElementIndex].element.stackElementRadius * templateFactor) + 'px; border-radius: ' + (elements[currentElementIndex].element.stackElementRadius * templateFactor / 2) + 'px;' | safeStyle"></div>
        </div>
    </div>
</div>